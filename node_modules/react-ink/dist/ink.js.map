{"version":3,"file":"ink.js","sources":["../src/util/hasTouch.js","../src/util/pixelRatio.js","../src/style.js","../src/util/easing.js","../src/util/equations.js","../src/util/store.js","../src/util/merge.js","../src/index.js"],"sourcesContent":["var bool = false\n\nif (typeof window !== 'undefined') {\n  bool =\n    'ontouchstart' in window ||\n    (window.DocumentTouch && document instanceof window.DocumentTouch)\n}\n\nexport const HAS_TOUCH = bool\n","// Good stuff here:\n// http://www.html5rocks.com/en/tutorials/canvas/hidpi/\n\nexport const pixelRatio = context => {\n  let devicePixelRatio = window.devicePixelRatio || 1\n  let backingStoreRatio =\n    context.webkitBackingStorePixelRatio ||\n    context.mozBackingStorePixelRatio ||\n    context.msBackingStorePixelRatio ||\n    context.oBackingStorePixelRatio ||\n    context.backingStorePixelRatio ||\n    1\n\n  return devicePixelRatio / backingStoreRatio\n}\n","export const STYLE = {\n  borderRadius: 'inherit',\n  height: '100%',\n  left: 0,\n  position: 'absolute',\n  top: 0,\n  width: '100%'\n}\n","/**\n * @t is the current time (or position) of the tween. This can be seconds or frames, steps, seconds, ms, whatever â€“ as long as the unit is the same as is used for the total time [3].\n * @b is the beginning value of the property.\n * @c is the change between the beginning and destination value of the property.\n * @d is the total time of the tween.\n */\n\nexport function easeOutQuint(t, b, c, d) {\n  return c * ((t = t / d - 1) * t * t * t * t + 1) + b\n}\n","import { easeOutQuint } from './easing'\n\nconst SQRT_2 = Math.sqrt(2)\nconst { cos, max, min } = Math\n\nfunction getPress(blot) {\n  return min(blot.duration, Date.now() - blot.mouseDown)\n}\n\nfunction getRelease(blot) {\n  return blot.mouseUp > 0 ? Date.now() - blot.mouseUp : 0\n}\n\nfunction getRadius(blot) {\n  let { duration, radius } = blot\n\n  let down = easeOutQuint(getPress(blot), 0, radius, duration) * 0.85\n  let up = easeOutQuint(getRelease(blot), 0, radius, duration) * 0.15\n  let undulation = radius * 0.02 * cos(Date.now() / duration)\n\n  return max(0, down + up + undulation)\n}\n\nexport function getMaxRadius(height, width, radius) {\n  return radius || min(max(height, width) * 0.6)\n}\n\nexport function getBlotOpacity(blot, opacity) {\n  return easeOutQuint(getRelease(blot), opacity, -opacity, blot.duration)\n}\n\nexport function getBlotOuterOpacity(blot, opacity) {\n  return min(\n    getBlotOpacity(blot, opacity),\n    easeOutQuint(getPress(blot), 0, 0.3, blot.duration * 3)\n  )\n}\n\nexport function getBlotShiftX(blot, size, width) {\n  return min(1, ((getRadius(blot) / size) * 2) / SQRT_2) * (width / 2 - blot.x)\n}\n\nexport function getBlotShiftY(blot, size, height) {\n  return min(1, ((getRadius(blot) / size) * 2) / SQRT_2) * (height / 2 - blot.y)\n}\n\nexport function getBlotScale(blot) {\n  return getRadius(blot) / blot.radius\n}\n","/**\n * Ink Store\n * Keeps track of changes to ripple epicenters\n * so that <Ink /> can focus on rendering them.\n */\n\nimport { getBlotOuterOpacity } from './equations'\n\nlet killStale = ({ mouseUp, duration }) =>\n  !mouseUp || Date.now() - mouseUp < duration\n\nexport function Store(publicize) {\n  let _data = []\n  let _playing = false\n  let _frame\n\n  let Store = {\n    each(callback, scope) {\n      for (var i = 0, l = _data.length; i < l; i++) {\n        callback.call(scope, _data[i])\n      }\n    },\n\n    play() {\n      if (!_playing) {\n        _playing = true\n        Store.update()\n      }\n    },\n\n    stop() {\n      _playing = false\n      cancelAnimationFrame(_frame)\n    },\n\n    getTotalOpacity(opacity) {\n      let answer = 0\n\n      for (var i = 0, l = _data.length; i < l; i++) {\n        answer += getBlotOuterOpacity(_data[i], opacity)\n      }\n\n      return answer\n    },\n\n    update() {\n      _data = _data.filter(killStale)\n\n      if (_data.length) {\n        _frame = requestAnimationFrame(Store.update)\n      } else {\n        Store.stop()\n      }\n\n      publicize()\n    },\n\n    add(props) {\n      _data.push(props)\n      Store.play()\n    },\n\n    release(time) {\n      for (let i = _data.length - 1; i >= 0; i--) {\n        if (!_data[i].mouseUp) {\n          return (_data[i].mouseUp = time)\n        }\n      }\n    }\n  }\n\n  return Store\n}\n","export function merge(/* args */) {\n  let copy = {}\n\n  for (var i = 0; i < arguments.length; i++) {\n    let subject = arguments[i]\n\n    if (subject) {\n      for (var key in subject) {\n        copy[key] = subject[key]\n      }\n    }\n  }\n\n  return copy\n}\n","/**\n * Ink\n * Fills a container with a canvas object that provides feedback on mouse/touch\n * events with a rippling pool.\n */\n\nimport React from 'react'\nimport { HAS_TOUCH } from './util/hasTouch'\nimport { pixelRatio } from './util/pixelRatio'\nimport { STYLE } from './style'\nimport { Store } from './util/store'\nimport { merge } from './util/merge'\nimport {\n  getBlotScale,\n  getBlotOpacity,\n  getBlotShiftX,\n  getBlotShiftY,\n  getMaxRadius\n} from './util/equations'\n\nconst TAU = Math.PI * 2\nconst MOUSE_LEFT = 0\n\nconst defaultProps = {\n  background: true,\n  className: 'ink',\n  duration: 1000,\n  opacity: 0.25,\n  recenter: true,\n  hasTouch: HAS_TOUCH\n}\n\nexport default class Ink extends React.PureComponent {\n  constructor(props) {\n    super(...arguments)\n\n    this.state = {\n      color: 'transparent',\n      density: 1,\n      height: 0,\n      store: Store(this.tick.bind(this)),\n      width: 0\n    }\n\n    this.touchEvents = this.touchEvents()\n  }\n\n  touchEvents() {\n    if (this.props.hasTouch) {\n      return {\n        onTouchStart: this._onPress.bind(this),\n        onTouchEnd: this._onRelease.bind(this),\n        onTouchCancel: this._onRelease.bind(this)\n      }\n    } else {\n      return {\n        onMouseDown: this._onPress.bind(this),\n        onMouseUp: this._onRelease.bind(this),\n        onMouseLeave: this._onRelease.bind(this)\n      }\n    }\n  }\n\n  tick() {\n    let { ctx, color, density, height, width, store } = this.state\n\n    ctx.save()\n\n    ctx.scale(density, density)\n\n    ctx.clearRect(0, 0, width, height)\n\n    ctx.fillStyle = color\n\n    if (this.props.background) {\n      ctx.globalAlpha = store.getTotalOpacity(this.props.opacity)\n      ctx.fillRect(0, 0, width, height)\n    }\n\n    store.each(this.makeBlot, this)\n\n    ctx.restore()\n  }\n\n  makeBlot(blot) {\n    let { ctx, height, width } = this.state\n    let { x, y, radius } = blot\n\n    ctx.globalAlpha = getBlotOpacity(blot, this.props.opacity)\n    ctx.beginPath()\n\n    if (this.props.recenter) {\n      let size = Math.max(height, width)\n\n      x += getBlotShiftX(blot, size, width)\n      y += getBlotShiftY(blot, size, height)\n    }\n\n    ctx.arc(x, y, radius * getBlotScale(blot), 0, TAU)\n\n    ctx.closePath()\n    ctx.fill()\n  }\n\n  componentWillUnmount() {\n    this.state.store.stop()\n  }\n\n  pushBlot(timeStamp, clientX, clientY) {\n    let el = this.canvas\n\n    // 0.13 support\n    if (el.getDOMNode && 'function' === typeof el.getDOMNode) {\n      el = el.getDOMNode()\n    }\n\n    let { top, bottom, left, right } = el.getBoundingClientRect()\n    let { color } = window.getComputedStyle(el)\n\n    let ctx = this.state.ctx || el.getContext('2d')\n    let density = pixelRatio(ctx)\n    let height = bottom - top\n    let width = right - left\n    let radius = getMaxRadius(height, width, this.props.radius)\n\n    this.setState({ color, ctx, density, height, width }, () => {\n      this.state.store.add({\n        duration: this.props.duration,\n        mouseDown: timeStamp,\n        mouseUp: 0,\n        radius: radius,\n        x: clientX - left,\n        y: clientY - top\n      })\n    })\n  }\n\n  setCanvas(el) {\n    this.canvas = el\n  }\n\n  render() {\n    let { density, height, width } = this.state\n    let { className, style } = this.props\n\n    let props = merge(\n      {\n        'aria-hidden': true,\n        className: className,\n        ref: this.setCanvas.bind(this),\n        height: height * density,\n        width: width * density,\n        onDragOver: this._onRelease.bind(this),\n        style: merge(STYLE, style)\n      },\n      this.touchEvents\n    )\n\n    return React.createElement('canvas', props)\n  }\n\n  _onPress(event) {\n    let { button, ctrlKey, clientX, clientY, changedTouches } = event\n    let timeStamp = Date.now()\n\n    if (changedTouches) {\n      for (var i = 0; i < changedTouches.length; i++) {\n        let { clientX, clientY } = changedTouches[i]\n        this.pushBlot(timeStamp, clientX, clientY)\n      }\n    } else if (button === MOUSE_LEFT && !ctrlKey) {\n      this.pushBlot(timeStamp, clientX, clientY)\n    }\n  }\n\n  _onRelease() {\n    this.state.store.release(Date.now())\n  }\n}\n\nInk.defaultProps = defaultProps\n"],"names":["bool","window","DocumentTouch","document","HAS_TOUCH","pixelRatio","context","devicePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","STYLE","borderRadius","height","left","position","top","width","easeOutQuint","t","b","c","d","const","SQRT_2","Math","sqrt","getPress","blot","min","duration","Date","now","mouseDown","getRelease","mouseUp","getRadius","down","radius","up","undulation","cos","max","getMaxRadius","getBlotOpacity","opacity","getBlotOuterOpacity","getBlotShiftX","size","x","getBlotShiftY","y","getBlotScale","let","killStale","ref","Store","publicize","_frame","_data","_playing","each","callback","scope","i","l","length","call","play","update","stop","cancelAnimationFrame","getTotalOpacity","answer","filter","requestAnimationFrame","add","props","push","release","time","merge","copy","arguments","subject","key","TAU","PI","MOUSE_LEFT","defaultProps","background","className","recenter","hasTouch","Ink","super","this","state","color","density","store","tick","bind","touchEvents","onTouchStart","_onPress","onTouchEnd","_onRelease","onTouchCancel","onMouseDown","onMouseUp","onMouseLeave","ctx","save","scale","clearRect","fillStyle","globalAlpha","fillRect","makeBlot","restore","beginPath","arc","closePath","fill","componentWillUnmount","pushBlot","timeStamp","clientX","clientY","el","canvas","getDOMNode","getBoundingClientRect","getComputedStyle","getContext","bottom","right","setState","setCanvas","render","aria-hidden","onDragOver","style","React","createElement","event","changedTouches","button","ctrlKey","PureComponent"],"mappings":"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"}